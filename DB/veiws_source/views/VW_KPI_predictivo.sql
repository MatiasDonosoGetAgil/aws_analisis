CREATE ALGORITHM=UNDEFINED DEFINER=`qa-general`@`%` SQL SECURITY DEFINER VIEW `VW_KPI_predictivo` AS select `X`.`Orden` AS `Orden`,`X`.`Comercio` AS `Comercio`,`X`.`Tipo` AS `Tipo`,`X`.`Mes` AS `Mes`,`X`.`MesActual` AS `MesActual`,`X`.`Hoy` AS `Hoy`,`X`.`L1` AS `L1`,`X`.`M1` AS `M1`,`X`.`X1` AS `X1`,`X`.`J1` AS `J1`,`X`.`V1` AS `V1`,`X`.`S1` AS `S1`,`X`.`D1` AS `D1`,`X`.`L2` AS `L2`,`X`.`M2` AS `M2`,`X`.`X2` AS `X2`,`X`.`J2` AS `J2`,`X`.`V2` AS `V2`,`X`.`S2` AS `S2`,`X`.`D2` AS `D2`,`X`.`L3` AS `L3`,`X`.`M3` AS `M3`,`X`.`X3` AS `X3`,`X`.`J3` AS `J3`,`X`.`V3` AS `V3`,`X`.`S3` AS `S3`,`X`.`D3` AS `D3`,`X`.`L4` AS `L4`,`X`.`M4` AS `M4`,`X`.`X4` AS `X4`,`X`.`J4` AS `J4`,`X`.`V4` AS `V4`,`X`.`S4` AS `S4`,`X`.`D4` AS `D4`,`X`.`L5` AS `L5`,`X`.`M5` AS `M5`,`X`.`X5` AS `X5`,`X`.`J5` AS `J5`,`X`.`V5` AS `V5`,`X`.`S5` AS `S5`,`X`.`D5` AS `D5`,`X`.`L6` AS `L6`,`X`.`M6` AS `M6`,`X`.`X6` AS `X6`,`X`.`J6` AS `J6`,`X`.`V6` AS `V6`,`X`.`S6` AS `S6`,`X`.`D6` AS `D6` from (select (case when ((`X`.`Mes` = (select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` order by `X`.`Fecha` desc limit 1)) and (`X`.`Tipo` = 'PEDIDOS')) then 1 when ((`X`.`Mes` = (select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` order by `X`.`Fecha` desc limit 1)) and (`X`.`Tipo` = 'SUBTOTAL')) then 2 when ((`X`.`Mes` = (select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` order by `X`.`Fecha` desc limit 1)) and (`X`.`Tipo` = 'NETO AGIL')) then 3 when ((`X`.`Mes` = (select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` order by `X`.`Fecha` limit 1)) and (`X`.`Tipo` = 'PEDIDOS')) then 4 when ((`X`.`Mes` = (select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` order by `X`.`Fecha` limit 1)) and (`X`.`Tipo` = 'SUBTOTAL')) then 5 when ((`X`.`Mes` = (select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` order by `X`.`Fecha` limit 1)) and (`X`.`Tipo` = 'NETO AGIL')) then 6 when (`X`.`Orden` = 11) then 7 when (`X`.`Orden` = 21) then 8 when (`X`.`Orden` = 31) then 9 when (`X`.`Orden` = 12) then 10 when (`X`.`Orden` = 22) then 11 when (`X`.`Orden` = 32) then 12 when (`X`.`Orden` = 13) then 13 when (`X`.`Orden` = 23) then 14 when (`X`.`Orden` = 33) then 15 end) AS `Orden`,`X`.`Comercio` AS `Comercio`,`X`.`Tipo` AS `Tipo`,(case when (`X`.`Mes` = 'January') then 'Enero' when (`X`.`Mes` = 'February') then 'Febrero' when (`X`.`Mes` = 'March') then 'Marzo' when (`X`.`Mes` = 'April') then 'Abril' when (`X`.`Mes` = 'May') then 'Mayo' when (`X`.`Mes` = 'June') then 'Junio' when (`X`.`Mes` = 'July') then 'Julio' when (`X`.`Mes` = 'August') then 'Agosto' when (`X`.`Mes` = 'September') then 'Septiembre' when (`X`.`Mes` = 'October') then 'Octubre' when (`X`.`Mes` = 'November') then 'Noviembre' when (`X`.`Mes` = 'December') then 'Diciembre' end) AS `Mes`,replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(`X`.`MesActual`,'January','Enero'),'February','Febrero'),'March','Marzo'),'April','Abril'),'May','Mayo'),'June','Junio'),'July','Julio'),'August','Agosto'),'September','Septiembre'),'October','Octubre'),'November','Noviembre'),'December','Diciembre') AS `MesActual`,(case when (dayofmonth(curdate()) < `X`.`PrimerLunes`) then concat(`X`.`DiaNombre`,'1') when ((dayofmonth(curdate()) >= `X`.`PrimerLunes`) and (dayofmonth(curdate()) < (`X`.`PrimerLunes` + 7))) then concat(`X`.`DiaNombre`,'2') when ((dayofmonth(curdate()) >= (`X`.`PrimerLunes` + 7)) and (dayofmonth(curdate()) < (`X`.`PrimerLunes` + 14))) then concat(`X`.`DiaNombre`,'3') when ((dayofmonth(curdate()) >= (`X`.`PrimerLunes` + 14)) and (dayofmonth(curdate()) < (`X`.`PrimerLunes` + 21))) then concat(`X`.`DiaNombre`,'4') when ((dayofmonth(curdate()) >= (`X`.`PrimerLunes` + 21)) and (dayofmonth(curdate()) < (`X`.`PrimerLunes` + 28))) then concat(`X`.`DiaNombre`,'5') when (dayofmonth(curdate()) >= (`X`.`PrimerLunes` + 28)) then concat(`X`.`DiaNombre`,'6') end) AS `Hoy`,`X`.`L1` AS `L1`,`X`.`M1` AS `M1`,`X`.`X1` AS `X1`,`X`.`J1` AS `J1`,`X`.`V1` AS `V1`,`X`.`S1` AS `S1`,`X`.`D1` AS `D1`,`X`.`L2` AS `L2`,`X`.`M2` AS `M2`,`X`.`X2` AS `X2`,`X`.`J2` AS `J2`,`X`.`V2` AS `V2`,`X`.`S2` AS `S2`,`X`.`D2` AS `D2`,`X`.`L3` AS `L3`,`X`.`M3` AS `M3`,`X`.`X3` AS `X3`,`X`.`J3` AS `J3`,`X`.`V3` AS `V3`,`X`.`S3` AS `S3`,`X`.`D3` AS `D3`,`X`.`L4` AS `L4`,`X`.`M4` AS `M4`,`X`.`X4` AS `X4`,`X`.`J4` AS `J4`,`X`.`V4` AS `V4`,`X`.`S4` AS `S4`,`X`.`D4` AS `D4`,`X`.`L5` AS `L5`,`X`.`M5` AS `M5`,`X`.`X5` AS `X5`,`X`.`J5` AS `J5`,`X`.`V5` AS `V5`,`X`.`S5` AS `S5`,`X`.`D5` AS `D5`,`X`.`L6` AS `L6`,`X`.`M6` AS `M6`,`X`.`X6` AS `X6`,`X`.`J6` AS `J6`,`X`.`V6` AS `V6`,`X`.`S6` AS `S6`,`X`.`D6` AS `D6` from (select (`X`.`Orden` + 10) AS `Orden`,`X`.`Comercio` AS `Comercio`,'PEDIDOS' AS `Tipo`,`X`.`Mes` AS `Mes`,concat((select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` order by `X`.`Fecha` limit 1),', ',(select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` order by `X`.`Fecha` desc limit 1)) AS `MesActual`,(case when (dayname(curdate()) in ('Monday','Lunes')) then 'L' when (dayname(curdate()) in ('Tuesday','Martes')) then 'M' when (dayname(curdate()) in ('Wednesday','Miércoles','Miercoles')) then 'X' when (dayname(curdate()) in ('Thursday','Jueves')) then 'J' when (dayname(curdate()) in ('Friday','Viernes')) then 'V' when (dayname(curdate()) in ('Saturday','Sábado','Sabado')) then 'S' when (dayname(curdate()) in ('Sunday','Domingo')) then 'D' end) AS `DiaNombre`,dayofmonth((date_format((curdate() + interval -(0) month),'%Y-%m-01') + interval ((9 - dayofweek(date_format((curdate() + interval -(0) month),'%Y-%m-01'))) % 7) day)) AS `PrimerLunes`,sum(`X`.`L1`) AS `L1`,sum(`X`.`M1`) AS `M1`,sum(`X`.`X1`) AS `X1`,sum(`X`.`J1`) AS `J1`,sum(`X`.`V1`) AS `V1`,sum(`X`.`S1`) AS `S1`,sum(`X`.`D1`) AS `D1`,sum(`X`.`L2`) AS `L2`,sum(`X`.`M2`) AS `M2`,sum(`X`.`X2`) AS `X2`,sum(`X`.`J2`) AS `J2`,sum(`X`.`V2`) AS `V2`,sum(`X`.`S2`) AS `S2`,sum(`X`.`D2`) AS `D2`,sum(`X`.`L3`) AS `L3`,sum(`X`.`M3`) AS `M3`,sum(`X`.`X3`) AS `X3`,sum(`X`.`J3`) AS `J3`,sum(`X`.`V3`) AS `V3`,sum(`X`.`S3`) AS `S3`,sum(`X`.`D3`) AS `D3`,sum(`X`.`L4`) AS `L4`,sum(`X`.`M4`) AS `M4`,sum(`X`.`X4`) AS `X4`,sum(`X`.`J4`) AS `J4`,sum(`X`.`V4`) AS `V4`,sum(`X`.`S4`) AS `S4`,sum(`X`.`D4`) AS `D4`,sum(`X`.`L5`) AS `L5`,sum(`X`.`M5`) AS `M5`,sum(`X`.`X5`) AS `X5`,sum(`X`.`J5`) AS `J5`,sum(`X`.`V5`) AS `V5`,sum(`X`.`S5`) AS `S5`,sum(`X`.`D5`) AS `D5`,sum(`X`.`L6`) AS `L6`,sum(`X`.`M6`) AS `M6`,sum(`X`.`X6`) AS `X6`,sum(`X`.`J6`) AS `J6`,sum(`X`.`V6`) AS `V6`,sum(`X`.`S6`) AS `S6`,sum(`X`.`D6`) AS `D6` from (select `X`.`Comercio` AS `Comercio`,`X`.`Mes` AS `Mes`,`X`.`Orden` AS `Orden`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 1)) then `X`.`Codigo` else 0 end) AS `L1`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 1)) then `X`.`Codigo` else 0 end) AS `M1`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 1)) then `X`.`Codigo` else 0 end) AS `X1`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 1)) then `X`.`Codigo` else 0 end) AS `J1`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 1)) then `X`.`Codigo` else 0 end) AS `V1`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 1)) then `X`.`Codigo` else 0 end) AS `S1`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 1)) then `X`.`Codigo` else 0 end) AS `D1`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 2)) then `X`.`Codigo` else 0 end) AS `L2`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 2)) then `X`.`Codigo` else 0 end) AS `M2`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 2)) then `X`.`Codigo` else 0 end) AS `X2`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 2)) then `X`.`Codigo` else 0 end) AS `J2`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 2)) then `X`.`Codigo` else 0 end) AS `V2`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 2)) then `X`.`Codigo` else 0 end) AS `S2`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 2)) then `X`.`Codigo` else 0 end) AS `D2`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 3)) then `X`.`Codigo` else 0 end) AS `L3`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 3)) then `X`.`Codigo` else 0 end) AS `M3`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 3)) then `X`.`Codigo` else 0 end) AS `X3`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 3)) then `X`.`Codigo` else 0 end) AS `J3`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 3)) then `X`.`Codigo` else 0 end) AS `V3`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 3)) then `X`.`Codigo` else 0 end) AS `S3`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 3)) then `X`.`Codigo` else 0 end) AS `D3`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 4)) then `X`.`Codigo` else 0 end) AS `L4`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 4)) then `X`.`Codigo` else 0 end) AS `M4`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 4)) then `X`.`Codigo` else 0 end) AS `X4`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 4)) then `X`.`Codigo` else 0 end) AS `J4`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 4)) then `X`.`Codigo` else 0 end) AS `V4`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 4)) then `X`.`Codigo` else 0 end) AS `S4`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 4)) then `X`.`Codigo` else 0 end) AS `D4`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 5)) then `X`.`Codigo` else 0 end) AS `L5`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 5)) then `X`.`Codigo` else 0 end) AS `M5`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 5)) then `X`.`Codigo` else 0 end) AS `X5`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 5)) then `X`.`Codigo` else 0 end) AS `J5`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 5)) then `X`.`Codigo` else 0 end) AS `V5`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 5)) then `X`.`Codigo` else 0 end) AS `S5`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 5)) then `X`.`Codigo` else 0 end) AS `D5`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 6)) then `X`.`Codigo` else 0 end) AS `L6`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 6)) then `X`.`Codigo` else 0 end) AS `M6`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 6)) then `X`.`Codigo` else 0 end) AS `X6`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 6)) then `X`.`Codigo` else 0 end) AS `J6`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 6)) then `X`.`Codigo` else 0 end) AS `V6`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 6)) then `X`.`Codigo` else 0 end) AS `S6`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 6)) then `X`.`Codigo` else 0 end) AS `D6` from (select `delivery`.`kpi_predictivo_ventas_detalle`.`Comercio` AS `Comercio`,`delivery`.`kpi_predictivo_ventas_detalle`.`Orden` AS `Orden`,`delivery`.`kpi_predictivo_ventas_detalle`.`Mes` AS `Mes`,`delivery`.`kpi_predictivo_ventas_detalle`.`DiaNombre` AS `DiaNombre`,`delivery`.`kpi_predictivo_ventas_detalle`.`Semana` AS `Semana`,`delivery`.`kpi_predictivo_ventas_detalle`.`Fecha` AS `Fecha`,count(`delivery`.`kpi_predictivo_ventas_detalle`.`Codigo`) AS `Codigo`,sum(`delivery`.`kpi_predictivo_ventas_detalle`.`Subtotal`) AS `Subtotal`,sum(`delivery`.`kpi_predictivo_ventas_detalle`.`NetoAgil`) AS `NetoAgil` from `delivery`.`kpi_predictivo_ventas_detalle` group by `delivery`.`kpi_predictivo_ventas_detalle`.`Comercio`,`delivery`.`kpi_predictivo_ventas_detalle`.`Orden`,`delivery`.`kpi_predictivo_ventas_detalle`.`Mes`,`delivery`.`kpi_predictivo_ventas_detalle`.`DiaNombre`,`delivery`.`kpi_predictivo_ventas_detalle`.`Semana`,`delivery`.`kpi_predictivo_ventas_detalle`.`Fecha` union all select `delivery`.`kpi_predictivo_ventas_prediccion`.`Comercio` AS `Comercio`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Orden` AS `Orden`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Mes` AS `Mes`,`delivery`.`kpi_predictivo_ventas_prediccion`.`DiaNombre` AS `DiaNombre`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Semana` AS `Semana`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Fecha` AS `Fecha`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Codigo` AS `Codigo`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Subtotal` AS `Subtotal`,`delivery`.`kpi_predictivo_ventas_prediccion`.`NetoAgil` AS `NetoAgil` from `delivery`.`kpi_predictivo_ventas_prediccion` order by `Comercio`,`Fecha`) `X` order by `X`.`Comercio`,`X`.`Fecha`) `X` group by `X`.`Comercio`,`X`.`Mes`,`X`.`Orden` union all select (`X`.`Orden` + 20) AS `Orden`,`X`.`Comercio` AS `Comercio`,'SUBTOTAL' AS `Tipo`,`X`.`Mes` AS `Mes`,concat((select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` order by `X`.`Fecha` limit 1),', ',(select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` order by `X`.`Fecha` desc limit 1)) AS `MesActual`,(case when (dayname(curdate()) in ('Monday','Lunes')) then 'L' when (dayname(curdate()) in ('Tuesday','Martes')) then 'M' when (dayname(curdate()) in ('Wednesday','Miércoles','Miercoles')) then 'X' when (dayname(curdate()) in ('Thursday','Jueves')) then 'J' when (dayname(curdate()) in ('Friday','Viernes')) then 'V' when (dayname(curdate()) in ('Saturday','Sábado','Sabado')) then 'S' when (dayname(curdate()) in ('Sunday','Domingo')) then 'D' end) AS `DiaNombre`,dayofmonth((date_format((curdate() + interval -(0) month),'%Y-%m-01') + interval ((9 - dayofweek(date_format((curdate() + interval -(0) month),'%Y-%m-01'))) % 7) day)) AS `PrimerLunes`,sum(`X`.`L1`) AS `L1`,sum(`X`.`M1`) AS `M1`,sum(`X`.`X1`) AS `X1`,sum(`X`.`J1`) AS `J1`,sum(`X`.`V1`) AS `V1`,sum(`X`.`S1`) AS `S1`,sum(`X`.`D1`) AS `D1`,sum(`X`.`L2`) AS `L2`,sum(`X`.`M2`) AS `M2`,sum(`X`.`X2`) AS `X2`,sum(`X`.`J2`) AS `J2`,sum(`X`.`V2`) AS `V2`,sum(`X`.`S2`) AS `S2`,sum(`X`.`D2`) AS `D2`,sum(`X`.`L3`) AS `L3`,sum(`X`.`M3`) AS `M3`,sum(`X`.`X3`) AS `X3`,sum(`X`.`J3`) AS `J3`,sum(`X`.`V3`) AS `V3`,sum(`X`.`S3`) AS `S3`,sum(`X`.`D3`) AS `D3`,sum(`X`.`L4`) AS `L4`,sum(`X`.`M4`) AS `M4`,sum(`X`.`X4`) AS `X4`,sum(`X`.`J4`) AS `J4`,sum(`X`.`V4`) AS `V4`,sum(`X`.`S4`) AS `S4`,sum(`X`.`D4`) AS `D4`,sum(`X`.`L5`) AS `L5`,sum(`X`.`M5`) AS `M5`,sum(`X`.`X5`) AS `X5`,sum(`X`.`J5`) AS `J5`,sum(`X`.`V5`) AS `V5`,sum(`X`.`S5`) AS `S5`,sum(`X`.`D5`) AS `D5`,sum(`X`.`L6`) AS `L6`,sum(`X`.`M6`) AS `M6`,sum(`X`.`X6`) AS `X6`,sum(`X`.`J6`) AS `J6`,sum(`X`.`V6`) AS `V6`,sum(`X`.`S6`) AS `S6`,sum(`X`.`D6`) AS `D6` from (select `X`.`Comercio` AS `Comercio`,`X`.`Mes` AS `Mes`,`X`.`Orden` AS `Orden`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 1)) then `X`.`Subtotal` else 0 end) AS `L1`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 1)) then `X`.`Subtotal` else 0 end) AS `M1`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 1)) then `X`.`Subtotal` else 0 end) AS `X1`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 1)) then `X`.`Subtotal` else 0 end) AS `J1`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 1)) then `X`.`Subtotal` else 0 end) AS `V1`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 1)) then `X`.`Subtotal` else 0 end) AS `S1`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 1)) then `X`.`Subtotal` else 0 end) AS `D1`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 2)) then `X`.`Subtotal` else 0 end) AS `L2`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 2)) then `X`.`Subtotal` else 0 end) AS `M2`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 2)) then `X`.`Subtotal` else 0 end) AS `X2`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 2)) then `X`.`Subtotal` else 0 end) AS `J2`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 2)) then `X`.`Subtotal` else 0 end) AS `V2`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 2)) then `X`.`Subtotal` else 0 end) AS `S2`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 2)) then `X`.`Subtotal` else 0 end) AS `D2`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 3)) then `X`.`Subtotal` else 0 end) AS `L3`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 3)) then `X`.`Subtotal` else 0 end) AS `M3`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 3)) then `X`.`Subtotal` else 0 end) AS `X3`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 3)) then `X`.`Subtotal` else 0 end) AS `J3`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 3)) then `X`.`Subtotal` else 0 end) AS `V3`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 3)) then `X`.`Subtotal` else 0 end) AS `S3`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 3)) then `X`.`Subtotal` else 0 end) AS `D3`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 4)) then `X`.`Subtotal` else 0 end) AS `L4`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 4)) then `X`.`Subtotal` else 0 end) AS `M4`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 4)) then `X`.`Subtotal` else 0 end) AS `X4`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 4)) then `X`.`Subtotal` else 0 end) AS `J4`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 4)) then `X`.`Subtotal` else 0 end) AS `V4`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 4)) then `X`.`Subtotal` else 0 end) AS `S4`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 4)) then `X`.`Subtotal` else 0 end) AS `D4`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 5)) then `X`.`Subtotal` else 0 end) AS `L5`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 5)) then `X`.`Subtotal` else 0 end) AS `M5`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 5)) then `X`.`Subtotal` else 0 end) AS `X5`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 5)) then `X`.`Subtotal` else 0 end) AS `J5`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 5)) then `X`.`Subtotal` else 0 end) AS `V5`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 5)) then `X`.`Subtotal` else 0 end) AS `S5`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 5)) then `X`.`Subtotal` else 0 end) AS `D5`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 6)) then `X`.`Subtotal` else 0 end) AS `L6`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 6)) then `X`.`Subtotal` else 0 end) AS `M6`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 6)) then `X`.`Subtotal` else 0 end) AS `X6`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 6)) then `X`.`Subtotal` else 0 end) AS `J6`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 6)) then `X`.`Subtotal` else 0 end) AS `V6`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 6)) then `X`.`Subtotal` else 0 end) AS `S6`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 6)) then `X`.`Subtotal` else 0 end) AS `D6` from (select `delivery`.`kpi_predictivo_ventas_detalle`.`Comercio` AS `Comercio`,`delivery`.`kpi_predictivo_ventas_detalle`.`Orden` AS `Orden`,`delivery`.`kpi_predictivo_ventas_detalle`.`Mes` AS `Mes`,`delivery`.`kpi_predictivo_ventas_detalle`.`DiaNombre` AS `DiaNombre`,`delivery`.`kpi_predictivo_ventas_detalle`.`Semana` AS `Semana`,`delivery`.`kpi_predictivo_ventas_detalle`.`Fecha` AS `Fecha`,count(`delivery`.`kpi_predictivo_ventas_detalle`.`Codigo`) AS `Codigo`,sum(`delivery`.`kpi_predictivo_ventas_detalle`.`Subtotal`) AS `Subtotal`,sum(`delivery`.`kpi_predictivo_ventas_detalle`.`NetoAgil`) AS `NetoAgil` from `delivery`.`kpi_predictivo_ventas_detalle` group by `delivery`.`kpi_predictivo_ventas_detalle`.`Comercio`,`delivery`.`kpi_predictivo_ventas_detalle`.`Orden`,`delivery`.`kpi_predictivo_ventas_detalle`.`Mes`,`delivery`.`kpi_predictivo_ventas_detalle`.`DiaNombre`,`delivery`.`kpi_predictivo_ventas_detalle`.`Semana`,`delivery`.`kpi_predictivo_ventas_detalle`.`Fecha` union all select `delivery`.`kpi_predictivo_ventas_prediccion`.`Comercio` AS `Comercio`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Orden` AS `Orden`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Mes` AS `Mes`,`delivery`.`kpi_predictivo_ventas_prediccion`.`DiaNombre` AS `DiaNombre`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Semana` AS `Semana`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Fecha` AS `Fecha`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Codigo` AS `Codigo`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Subtotal` AS `Subtotal`,`delivery`.`kpi_predictivo_ventas_prediccion`.`NetoAgil` AS `NetoAgil` from `delivery`.`kpi_predictivo_ventas_prediccion` order by `Comercio`,`Fecha`) `X` order by `X`.`Comercio`,`X`.`Fecha`) `X` group by `X`.`Comercio`,`X`.`Mes`,`X`.`Orden` union all select (`X`.`Orden` + 30) AS `Orden`,`X`.`Comercio` AS `Comercio`,'NETO AGIL' AS `Tipo`,`X`.`Mes` AS `Mes`,concat((select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` order by `X`.`Fecha` limit 1),', ',(select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` order by `X`.`Fecha` desc limit 1)) AS `MesActual`,(case when (dayname(curdate()) in ('Monday','Lunes')) then 'L' when (dayname(curdate()) in ('Tuesday','Martes')) then 'M' when (dayname(curdate()) in ('Wednesday','Miércoles','Miercoles')) then 'X' when (dayname(curdate()) in ('Thursday','Jueves')) then 'J' when (dayname(curdate()) in ('Friday','Viernes')) then 'V' when (dayname(curdate()) in ('Saturday','Sábado','Sabado')) then 'S' when (dayname(curdate()) in ('Sunday','Domingo')) then 'D' end) AS `DiaNombre`,dayofmonth((date_format((curdate() + interval -(0) month),'%Y-%m-01') + interval ((9 - dayofweek(date_format((curdate() + interval -(0) month),'%Y-%m-01'))) % 7) day)) AS `PrimerLunes`,sum(`X`.`L1`) AS `L1`,sum(`X`.`M1`) AS `M1`,sum(`X`.`X1`) AS `X1`,sum(`X`.`J1`) AS `J1`,sum(`X`.`V1`) AS `V1`,sum(`X`.`S1`) AS `S1`,sum(`X`.`D1`) AS `D1`,sum(`X`.`L2`) AS `L2`,sum(`X`.`M2`) AS `M2`,sum(`X`.`X2`) AS `X2`,sum(`X`.`J2`) AS `J2`,sum(`X`.`V2`) AS `V2`,sum(`X`.`S2`) AS `S2`,sum(`X`.`D2`) AS `D2`,sum(`X`.`L3`) AS `L3`,sum(`X`.`M3`) AS `M3`,sum(`X`.`X3`) AS `X3`,sum(`X`.`J3`) AS `J3`,sum(`X`.`V3`) AS `V3`,sum(`X`.`S3`) AS `S3`,sum(`X`.`D3`) AS `D3`,sum(`X`.`L4`) AS `L4`,sum(`X`.`M4`) AS `M4`,sum(`X`.`X4`) AS `X4`,sum(`X`.`J4`) AS `J4`,sum(`X`.`V4`) AS `V4`,sum(`X`.`S4`) AS `S4`,sum(`X`.`D4`) AS `D4`,sum(`X`.`L5`) AS `L5`,sum(`X`.`M5`) AS `M5`,sum(`X`.`X5`) AS `X5`,sum(`X`.`J5`) AS `J5`,sum(`X`.`V5`) AS `V5`,sum(`X`.`S5`) AS `S5`,sum(`X`.`D5`) AS `D5`,sum(`X`.`L6`) AS `L6`,sum(`X`.`M6`) AS `M6`,sum(`X`.`X6`) AS `X6`,sum(`X`.`J6`) AS `J6`,sum(`X`.`V6`) AS `V6`,sum(`X`.`S6`) AS `S6`,sum(`X`.`D6`) AS `D6` from (select `X`.`Comercio` AS `Comercio`,`X`.`Mes` AS `Mes`,`X`.`Orden` AS `Orden`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 1)) then `X`.`NetoAgil` else 0 end) AS `L1`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 1)) then `X`.`NetoAgil` else 0 end) AS `M1`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 1)) then `X`.`NetoAgil` else 0 end) AS `X1`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 1)) then `X`.`NetoAgil` else 0 end) AS `J1`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 1)) then `X`.`NetoAgil` else 0 end) AS `V1`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 1)) then `X`.`NetoAgil` else 0 end) AS `S1`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 1)) then `X`.`NetoAgil` else 0 end) AS `D1`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 2)) then `X`.`NetoAgil` else 0 end) AS `L2`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 2)) then `X`.`NetoAgil` else 0 end) AS `M2`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 2)) then `X`.`NetoAgil` else 0 end) AS `X2`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 2)) then `X`.`NetoAgil` else 0 end) AS `J2`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 2)) then `X`.`NetoAgil` else 0 end) AS `V2`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 2)) then `X`.`NetoAgil` else 0 end) AS `S2`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 2)) then `X`.`NetoAgil` else 0 end) AS `D2`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 3)) then `X`.`NetoAgil` else 0 end) AS `L3`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 3)) then `X`.`NetoAgil` else 0 end) AS `M3`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 3)) then `X`.`NetoAgil` else 0 end) AS `X3`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 3)) then `X`.`NetoAgil` else 0 end) AS `J3`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 3)) then `X`.`NetoAgil` else 0 end) AS `V3`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 3)) then `X`.`NetoAgil` else 0 end) AS `S3`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 3)) then `X`.`NetoAgil` else 0 end) AS `D3`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 4)) then `X`.`NetoAgil` else 0 end) AS `L4`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 4)) then `X`.`NetoAgil` else 0 end) AS `M4`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 4)) then `X`.`NetoAgil` else 0 end) AS `X4`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 4)) then `X`.`NetoAgil` else 0 end) AS `J4`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 4)) then `X`.`NetoAgil` else 0 end) AS `V4`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 4)) then `X`.`NetoAgil` else 0 end) AS `S4`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 4)) then `X`.`NetoAgil` else 0 end) AS `D4`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 5)) then `X`.`NetoAgil` else 0 end) AS `L5`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 5)) then `X`.`NetoAgil` else 0 end) AS `M5`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 5)) then `X`.`NetoAgil` else 0 end) AS `X5`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 5)) then `X`.`NetoAgil` else 0 end) AS `J5`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 5)) then `X`.`NetoAgil` else 0 end) AS `V5`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 5)) then `X`.`NetoAgil` else 0 end) AS `S5`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 5)) then `X`.`NetoAgil` else 0 end) AS `D5`,(case when ((`X`.`DiaNombre` = 'L') and (`X`.`Semana` = 6)) then `X`.`NetoAgil` else 0 end) AS `L6`,(case when ((`X`.`DiaNombre` = 'M') and (`X`.`Semana` = 6)) then `X`.`NetoAgil` else 0 end) AS `M6`,(case when ((`X`.`DiaNombre` = 'X') and (`X`.`Semana` = 6)) then `X`.`NetoAgil` else 0 end) AS `X6`,(case when ((`X`.`DiaNombre` = 'J') and (`X`.`Semana` = 6)) then `X`.`NetoAgil` else 0 end) AS `J6`,(case when ((`X`.`DiaNombre` = 'V') and (`X`.`Semana` = 6)) then `X`.`NetoAgil` else 0 end) AS `V6`,(case when ((`X`.`DiaNombre` = 'S') and (`X`.`Semana` = 6)) then `X`.`NetoAgil` else 0 end) AS `S6`,(case when ((`X`.`DiaNombre` = 'D') and (`X`.`Semana` = 6)) then `X`.`NetoAgil` else 0 end) AS `D6` from (select `delivery`.`kpi_predictivo_ventas_detalle`.`Comercio` AS `Comercio`,`delivery`.`kpi_predictivo_ventas_detalle`.`Orden` AS `Orden`,`delivery`.`kpi_predictivo_ventas_detalle`.`Mes` AS `Mes`,`delivery`.`kpi_predictivo_ventas_detalle`.`DiaNombre` AS `DiaNombre`,`delivery`.`kpi_predictivo_ventas_detalle`.`Semana` AS `Semana`,`delivery`.`kpi_predictivo_ventas_detalle`.`Fecha` AS `Fecha`,count(`delivery`.`kpi_predictivo_ventas_detalle`.`Codigo`) AS `Codigo`,sum(`delivery`.`kpi_predictivo_ventas_detalle`.`Subtotal`) AS `Subtotal`,sum(`delivery`.`kpi_predictivo_ventas_detalle`.`NetoAgil`) AS `NetoAgil` from `delivery`.`kpi_predictivo_ventas_detalle` group by `delivery`.`kpi_predictivo_ventas_detalle`.`Comercio`,`delivery`.`kpi_predictivo_ventas_detalle`.`Orden`,`delivery`.`kpi_predictivo_ventas_detalle`.`Mes`,`delivery`.`kpi_predictivo_ventas_detalle`.`DiaNombre`,`delivery`.`kpi_predictivo_ventas_detalle`.`Semana`,`delivery`.`kpi_predictivo_ventas_detalle`.`Fecha` union all select `delivery`.`kpi_predictivo_ventas_prediccion`.`Comercio` AS `Comercio`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Orden` AS `Orden`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Mes` AS `Mes`,`delivery`.`kpi_predictivo_ventas_prediccion`.`DiaNombre` AS `DiaNombre`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Semana` AS `Semana`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Fecha` AS `Fecha`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Codigo` AS `Codigo`,`delivery`.`kpi_predictivo_ventas_prediccion`.`Subtotal` AS `Subtotal`,`delivery`.`kpi_predictivo_ventas_prediccion`.`NetoAgil` AS `NetoAgil` from `delivery`.`kpi_predictivo_ventas_prediccion` order by `Comercio`,`Fecha`) `X` order by `X`.`Comercio`,`X`.`Fecha`) `X` group by `X`.`Comercio`,`X`.`Mes`,`X`.`Orden`) `X`) `X` order by `X`.`Comercio`,`X`.`Orden`