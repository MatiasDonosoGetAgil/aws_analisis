CREATE ALGORITHM=UNDEFINED DEFINER=`qa-general`@`%` SQL SECURITY DEFINER VIEW `VW_CashflowVentaDiaria` AS select distinct `X`.`IdPedido` AS `Pedido`,cast(date_format(`X`.`FechaEstimadaEntregaMin`,'%Y-%m-%d') as date) AS `Fecha`,`X`.`TipoEntrega` AS `TipoEntrega`,`X`.`Sucursal` AS `Sucursal`,`X`.`TotalBoleta` AS `TotalBoleta`,(case when (`X`.`EstadoPago` = 'Activo') then 1 else 0 end) AS `PedidosPagados`,(case when (`X`.`EstadoPago` = 'Reembolsado') then 1 else 0 end) AS `PedidosReembolsados`,(case when (`X`.`EstadoPago` = 'Activo') then `X`.`TotalBoleta` else 0 end) AS `MontoPagados`,(case when (`X`.`EstadoPago` = 'Reembolsado') then `X`.`TotalBoleta` else 0 end) AS `MontoReembolsos` from `dw_base_financiera` `X` where ((`X`.`CodigoTipoPedido` in ('PEDNORMAL','PEDESPECIAL')) and ((`X`.`EsPedidoHijo` = 'SI') or ((`X`.`EsPedidoHijo` = 'NO') and (`X`.`EstadoPago` in ('Activo','Reembolsado')))) and (date_format(`X`.`FechaEstimadaEntregaMin`,'%Y-%m-%d') >= date_format((now() - interval (((weekday(now()) + 7) % 7) + 7) day),'%Y-%m-%d')))