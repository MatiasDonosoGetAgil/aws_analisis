CREATE ALGORITHM=UNDEFINED DEFINER=`qa-general`@`%` SQL SECURITY DEFINER VIEW `periodosFacturacionSucursal` AS select `sc`.`IdSucursal` AS `IdSucursal`,`fechas`.`Fecha` AS `InicioPeriodo`,(`fechas`.`Fecha` + interval (`sc`.`CantidadDiasPeriodos` - 1) day) AS `FinPeriodo`,(`fechas`.`Fecha` + interval ((`sc`.`CantidadDiasPeriodos` - 1) + `sc`.`DiaPagoPosteriorAlCierre`) day) AS `FechaFacturacion` from (((select `sc`.`IdSucursal` AS `IdSucursal`,`c`.`Fecha` AS `Fecha`,cast(`sc`.`InicioPeriodoFacturacion` as date) AS `InicioPeriodoFacturacion`,(to_days(`c`.`Fecha`) - to_days(cast(`sc`.`InicioPeriodoFacturacion` as date))) AS `DistanciaDias`,`c`.`NumDiaSemana` AS `NumDiaSemana`,`c`.`NombreDiaSemana` AS `NombreDiaSemana` from (`delivery`.`calendario` `c` left join `delivery`.`sucursal_contrato` `sc` on((`sc`.`IdEstado` = 1))))) `fechas` left join `delivery`.`sucursal_contrato` `sc` on((`sc`.`IdSucursal` = `fechas`.`IdSucursal`))) where ((`fechas`.`DistanciaDias` % `sc`.`CantidadDiasPeriodos`) = 0) order by (`fechas`.`Fecha` + interval ((`sc`.`CantidadDiasPeriodos` - 1) + `sc`.`DiaPagoPosteriorAlCierre`) day)