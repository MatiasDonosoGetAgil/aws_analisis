select `X`.`DiaDepositoComercio` AS `Fecha`,sum(`X`.`CantidadPedidos`) AS `CantidadPedidos`,cast(round(sum(`X`.`ComisionVentaNeto`),0) as decimal(20,0)) AS `FeeVentas`,cast(round(sum(`X`.`ComisionDeliveryNeto`),0) as decimal(20,0)) AS `FeeDelivery`,cast(round(sum(`X`.`DeliveryAgilCharge`),0) as decimal(20,0)) AS `DeliveryAgilCharge`,cast(round(sum(`X`.`IngresoAgilNetoEspecial`),0) as decimal(20,0)) AS `IngresoAgilNetoEspecial`,cast(round(sum(`X`.`IngresoAgilNetoFlash`),0) as decimal(20,0)) AS `IngresoAgilNetoFlash`,cast(round(sum(`X`.`PropinaAgilDelivery`),0) as decimal(20,0)) AS `PropinaAgilDelivery`,cast(round(sum(`X`.`PropinaAgilRetiro`),0) as decimal(20,0)) AS `PropinaAgilRetiro`,cast(round(sum(`X`.`IngresoAgilNeto`),0) as decimal(20,0)) AS `IngresoAgilNeto`,(cast(round(sum(`X`.`IngresoAgilNeto`),0) as decimal(20,0)) * (`X`.`IvaPais` / 100)) AS `IvaAgil`,(((cast(round(sum(`X`.`IngresoAgilNeto`),0) as decimal(20,0)) + cast(round(sum(`X`.`PropinaAgilDelivery`),0) as decimal(20,0))) + cast(round(sum(`X`.`PropinaAgilRetiro`),0) as decimal(20,0))) + cast(round(sum(`X`.`FeePay`),0) as decimal(20,0))) AS `IncomeAgil`,cast(round(sum(`X`.`CuotaPasarelaNeto`),0) as decimal(20,0)) AS `CuotaPasarelaNeto`,cast(round(sum(`X`.`CuotaPasarelaIva`),0) as decimal(20,0)) AS `CuotaPasarelaIva`,cast(round(sum(`X`.`CuotaPasarelaBruto`),0) as decimal(20,0)) AS `CuotaPasarelaBruto`,cast(round(sum(`X`.`CuotaServicioAgilNeto`),0) as decimal(20,0)) AS `CuotaServicioAgilNeto`,cast(round(sum(`X`.`CuotaServicioAgilIva`),0) as decimal(20,0)) AS `CuotaServicioAgilIva`,cast(round(sum(`X`.`CuotaServicioAgilBruto`),0) as decimal(20,0)) AS `CuotaServicioAgilBruto`,cast(round(sum(`X`.`FeePay`),0) as decimal(20,0)) AS `FeePay`,cast(round(sum(`X`.`CargosKamNeto`),0) as decimal(20,0)) AS `CargosKamNeto`,cast(round(sum(`X`.`CargosAdsNeto`),0) as decimal(20,0)) AS `CargosAdsNeto` from (select `X`.`DiaDepositoComercio` AS `DiaDepositoComercio`,count(1) AS `CantidadPedidos`,`X`.`PeriodoFacturacionInicioComercio` AS `PeriodoFacturacionInicioComercio`,`X`.`PeriodoFacturacionFinComercio` AS `PeriodoFacturacionFinComercio`,`X`.`IdSucursal` AS `IdSucursal`,ifnull(sum(`X`.`ComisionVentaNeto`),0) AS `ComisionVentaNeto`,ifnull(sum(`X`.`ComisionDeliveryNeto`),0) AS `ComisionDeliveryNeto`,ifnull(sum(`X`.`DeliveryAgilCharge`),0) AS `DeliveryAgilCharge`,ifnull(sum(`X`.`PropinaAgilDelivery`),0) AS `PropinaAgilDelivery`,ifnull(sum(`X`.`PropinaAgilRetiro`),0) AS `PropinaAgilRetiro`,`X`.`IvaPais` AS `IvaPais`,((((((ifnull(sum(`X`.`ComisionVentaNeto`),0) + ifnull(sum(`X`.`ComisionDeliveryNeto`),0)) + ifnull(sum(`X`.`DeliveryAgilCharge`),0)) + ifnull(sum(`X`.`CuotaPasarelaNeto`),0)) + ifnull(sum(`X`.`CuotaServicioAgilNeto`),0)) + ifnull(`KAM`.`MontoNeto`,0)) + ifnull(`ADS`.`MontoNeto`,0)) AS `IngresoAgilNeto`,if((`X`.`CodigoTipoPedido` = 'PEDNORMAL'),((((ifnull(sum(`X`.`ComisionVentaNeto`),0) + ifnull(sum(`X`.`ComisionDeliveryNeto`),0)) + ifnull(sum(`X`.`DeliveryAgilCharge`),0)) + ifnull(sum(`X`.`CuotaPasarelaNeto`),0)) + ifnull(sum(`X`.`CuotaServicioAgilNeto`),0)),0) AS `IngresoAgilNetoNormal`,if((`X`.`CodigoTipoPedido` = 'PEDESPECIAL'),(((ifnull(sum(`X`.`ComisionVentaNeto`),0) + ifnull(sum(`X`.`ComisionDeliveryNeto`),0)) + ifnull(sum(`X`.`DeliveryAgilCharge`),0)) + ifnull(sum(`X`.`CuotaPasarelaNeto`),0)),0) AS `IngresoAgilNetoEspecial`,if((`X`.`CodigoTipoPedido` = 'PEDAGILFAVOR'),((ifnull(sum(`X`.`ComisionVentaNeto`),0) + ifnull(sum(`X`.`ComisionDeliveryNeto`),0)) + ifnull(sum(`X`.`DeliveryAgilCharge`),0)),0) AS `IngresoAgilNetoFlash`,ifnull(sum(`X`.`CuotaPasarelaNeto`),0) AS `CuotaPasarelaNeto`,ifnull(sum(`X`.`CuotaPasarelaIva`),0) AS `CuotaPasarelaIva`,ifnull(sum(`X`.`CuotaPasarelaBruto`),0) AS `CuotaPasarelaBruto`,ifnull(sum(`X`.`CuotaServicioAgilNeto`),0) AS `CuotaServicioAgilNeto`,ifnull(sum(`X`.`CuotaServicioAgilIva`),0) AS `CuotaServicioAgilIva`,ifnull(sum(`X`.`CuotaServicioAgilBruto`),0) AS `CuotaServicioAgilBruto`,ifnull(sum(`X`.`FeePay`),0) AS `FeePay`,ifnull(`KAM`.`MontoNeto`,0) AS `CargosKamNeto`,ifnull(`ADS`.`MontoNeto`,0) AS `CargosAdsNeto` from ((`delivery`.`dw_base_financiera` `X` left join (select `T`.`IdTipoAjusteFinanciero` AS `IdTipoAjusteFinanciero`,`T`.`Nombre` AS `TipoAjusteFinanciero`,`A`.`IdSucursal` AS `IdSucursal`,`A`.`PeriodoDesde` AS `PeriodoInicio`,`A`.`PeriodoHasta` AS `PeriodoFin`,sum(1) AS `Cantidad`,sum(if(isnull(`A`.`MontoNeto`),0,`A`.`MontoNeto`)) AS `MontoNeto`,sum(if(isnull(`A`.`MontoIVA`),0,`A`.`MontoIVA`)) AS `MontoIva`,sum(if(isnull(`A`.`MontoBruto`),0,`A`.`MontoBruto`)) AS `MontoBruto` from (((`delivery`.`sucursal_ajuste_financiero` `A` join `delivery`.`tipo_ajuste_financiero` `T` on((`A`.`IdTipoAjusteFinanciero` = `T`.`IdTipoAjusteFinanciero`))) join `delivery`.`estado_ajuste_financiero` `E` on((`A`.`IdEstado` = `E`.`IdEstado`))) join `delivery`.`cuenta_financiera` `C` on((`C`.`IdCuentaFinanciera` = `A`.`IdCuentaFinanciera`))) where ((`T`.`IdTipoAjusteFinanciero` = 2) and (`E`.`IdEstado` in (1,2)) and (`C`.`SKU` = 'CSUC07') and (`A`.`PeriodoDesde` >= '2024/01/01')) group by `T`.`IdTipoAjusteFinanciero`,`T`.`Nombre`,`A`.`IdSucursal`,`A`.`PeriodoDesde`,`A`.`PeriodoHasta`) `KAM` on(((`X`.`PeriodoFacturacionInicioComercio` = `KAM`.`PeriodoInicio`) and (`X`.`PeriodoFacturacionFinComercio` = `KAM`.`PeriodoFin`) and (`X`.`IdSucursal` = `KAM`.`IdSucursal`)))) left join (select `T`.`IdTipoAjusteFinanciero` AS `IdTipoAjusteFinanciero`,`T`.`Nombre` AS `TipoAjusteFinanciero`,`A`.`IdSucursal` AS `IdSucursal`,`A`.`PeriodoDesde` AS `PeriodoInicio`,`A`.`PeriodoHasta` AS `PeriodoFin`,sum(1) AS `Cantidad`,sum(if(isnull(`A`.`MontoNeto`),0,`A`.`MontoNeto`)) AS `MontoNeto`,sum(if(isnull(`A`.`MontoIVA`),0,`A`.`MontoIVA`)) AS `MontoIva`,sum(if(isnull(`A`.`MontoBruto`),0,`A`.`MontoBruto`)) AS `MontoBruto` from (((`delivery`.`sucursal_ajuste_financiero` `A` join `delivery`.`tipo_ajuste_financiero` `T` on((`A`.`IdTipoAjusteFinanciero` = `T`.`IdTipoAjusteFinanciero`))) join `delivery`.`estado_ajuste_financiero` `E` on((`A`.`IdEstado` = `E`.`IdEstado`))) join `delivery`.`cuenta_financiera` `C` on((`C`.`IdCuentaFinanciera` = `A`.`IdCuentaFinanciera`))) where ((`T`.`IdTipoAjusteFinanciero` = 2) and (`E`.`IdEstado` in (1,2)) and (`C`.`SKU` = 'CSUC08') and (`A`.`PeriodoDesde` >= '2024/01/01')) group by `T`.`IdTipoAjusteFinanciero`,`T`.`Nombre`,`A`.`IdSucursal`,`A`.`PeriodoDesde`,`A`.`PeriodoHasta`) `ADS` on(((`X`.`PeriodoFacturacionInicioComercio` = `ADS`.`PeriodoInicio`) and (`X`.`PeriodoFacturacionFinComercio` = `ADS`.`PeriodoFin`) and (`X`.`IdSucursal` = `ADS`.`IdSucursal`)))) where ((`X`.`CodigoTipoPedido` in ('PEDNORMAL','PEDESPECIAL','PEDAGILFAVOR')) and ((`X`.`CodigoTipoPedido` = 'PEDAGILFAVOR') or (`X`.`EsPedidoHijo` = 'SI') or ((`X`.`EsPedidoHijo` = 'NO') and (`X`.`EstadoPago` in ('Activo','Reembolsado'))))) group by `X`.`IdComercio`,`X`.`Comercio`,`X`.`IdSucursal`,`X`.`Sucursal`,`X`.`DiaDepositoComercio`,`X`.`PeriodoFacturacionInicioComercio`,`X`.`PeriodoFacturacionFinComercio`,`X`.`IvaPais`) `X` where (`X`.`PeriodoFacturacionInicioComercio` is not null) group by `X`.`DiaDepositoComercio` order by `X`.`DiaDepositoComercio` desc