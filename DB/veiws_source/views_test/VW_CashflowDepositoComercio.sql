select `X`.`DiaDepositoComercio` AS `DiaDepositoComercio`,sum(`X`.`CantidadPedidos`) AS `CantidadPedidos`,cast(round(sum(`X`.`DepositoComercioSinAjustes`),0) as decimal(20,0)) AS `DepositoComercioSinAjustes`,round(sum(`X`.`DevolucionesCantidad`),0) AS `DevolucionesCantidad`,cast(round(sum(`X`.`DevolucionesBruto`),0) as decimal(20,0)) AS `DevolucionesBruto`,round(sum(`X`.`CargosCantidad`),0) AS `CargosCantidad`,cast(round(sum(`X`.`CargosBruto`),0) as decimal(20,0)) AS `CargosBruto`,cast(round(sum(`X`.`PropinaComercioRetiro`),0) as decimal(20,0)) AS `PropinaComercioRetiro`,cast(round(sum(`X`.`DepositoComercio`),0) as decimal(20,0)) AS `DepositoComercio`,cast(round(sum(`X`.`CuotaServicioAgilNeto`),0) as decimal(20,0)) AS `CuotaServicioAgilNeto`,cast(round(sum(`X`.`CuotaServicioAgilIva`),0) as decimal(20,0)) AS `CuotaServicioAgilIva`,cast(round(sum(`X`.`CuotaServicioAgilBruto`),0) as decimal(20,0)) AS `CuotaServicioAgilBruto`,cast(round(sum(`X`.`CuotaPasarelaNeto`),0) as decimal(20,0)) AS `CuotaPasarelaNeto`,cast(round(sum(`X`.`CuotaPasarelaIva`),0) as decimal(20,0)) AS `CuotaPasarelaIva`,cast(round(sum(`X`.`CuotaPasarelaBruto`),0) as decimal(20,0)) AS `CuotaPasarelaBruto` from (select `X`.`IdComercio` AS `IdComercio`,`X`.`Comercio` AS `Comercio`,`X`.`IdSucursal` AS `IdSucursal`,`X`.`Sucursal` AS `Sucursal`,`X`.`DiaDepositoComercio` AS `DiaDepositoComercio`,count(1) AS `CantidadPedidos`,`X`.`PeriodoFacturacionInicioComercio` AS `PeriodoFacturacionInicioComercio`,`X`.`PeriodoFacturacionFinComercio` AS `PeriodoFacturacionFinComercio`,ifnull(sum(`X`.`DepositoComercio`),0) AS `DepositoComercioSinAjustes`,ifnull(`DEV`.`Cantidad`,0) AS `DevolucionesCantidad`,ifnull(`DEV`.`MontoBruto`,0) AS `DevolucionesBruto`,ifnull(`CAR`.`Cantidad`,0) AS `CargosCantidad`,ifnull(`CAR`.`MontoBruto`,0) AS `CargosBruto`,ifnull(`X`.`PropinaComercioRetiro`,0) AS `PropinaComercioRetiro`,((ifnull(sum(`X`.`DepositoComercio`),0) + ifnull(`DEV`.`MontoBruto`,0)) - ifnull(`CAR`.`MontoBruto`,0)) AS `DepositoComercio`,ifnull(sum(`X`.`CuotaServicioAgilNeto`),0) AS `CuotaServicioAgilNeto`,ifnull(sum(`X`.`CuotaServicioAgilIva`),0) AS `CuotaServicioAgilIva`,ifnull(sum(`X`.`CuotaServicioAgilBruto`),0) AS `CuotaServicioAgilBruto`,ifnull(sum(`X`.`CuotaPasarelaNeto`),0) AS `CuotaPasarelaNeto`,ifnull(sum(`X`.`CuotaPasarelaIva`),0) AS `CuotaPasarelaIva`,ifnull(sum(`X`.`CuotaPasarelaBruto`),0) AS `CuotaPasarelaBruto` from ((`delivery`.`dw_base_financiera` `X` left join (select `T`.`IdTipoAjusteFinanciero` AS `IdTipoAjusteFinanciero`,`T`.`Nombre` AS `TipoAjusteFinanciero`,`A`.`IdSucursal` AS `IdSucursal`,`A`.`PeriodoDesde` AS `PeriodoInicio`,`A`.`PeriodoHasta` AS `PeriodoFin`,sum(1) AS `Cantidad`,sum(if(isnull(`A`.`MontoNeto`),0,`A`.`MontoNeto`)) AS `MontoNeto`,sum(if(isnull(`A`.`MontoIVA`),0,`A`.`MontoIVA`)) AS `MontoIva`,sum(if(isnull(`A`.`MontoBruto`),0,`A`.`MontoBruto`)) AS `MontoBruto` from (((`delivery`.`sucursal_ajuste_financiero` `A` join `delivery`.`tipo_ajuste_financiero` `T` on((`A`.`IdTipoAjusteFinanciero` = `T`.`IdTipoAjusteFinanciero`))) join `delivery`.`estado_ajuste_financiero` `E` on((`A`.`IdEstado` = `E`.`IdEstado`))) join `delivery`.`cuenta_financiera` `C` on((`C`.`IdCuentaFinanciera` = `A`.`IdCuentaFinanciera`))) where ((`T`.`IdTipoAjusteFinanciero` = 1) and (`E`.`IdEstado` in (1,2)) and (`C`.`SKU` <> 'CSUC09')) group by `T`.`IdTipoAjusteFinanciero`,`T`.`Nombre`,`A`.`IdSucursal`,`A`.`PeriodoDesde`,`A`.`PeriodoHasta`) `DEV` on(((`X`.`PeriodoFacturacionInicioComercio` = `DEV`.`PeriodoInicio`) and (`X`.`PeriodoFacturacionFinComercio` = `DEV`.`PeriodoFin`) and (`X`.`IdSucursal` = `DEV`.`IdSucursal`)))) left join (select `T`.`IdTipoAjusteFinanciero` AS `IdTipoAjusteFinanciero`,`T`.`Nombre` AS `TipoAjusteFinanciero`,`A`.`IdSucursal` AS `IdSucursal`,`A`.`PeriodoDesde` AS `PeriodoInicio`,`A`.`PeriodoHasta` AS `PeriodoFin`,sum(1) AS `Cantidad`,sum(if(isnull(`A`.`MontoNeto`),0,`A`.`MontoNeto`)) AS `MontoNeto`,sum(if(isnull(`A`.`MontoIVA`),0,`A`.`MontoIVA`)) AS `MontoIva`,sum(if(isnull(`A`.`MontoBruto`),0,`A`.`MontoBruto`)) AS `MontoBruto` from (((`delivery`.`sucursal_ajuste_financiero` `A` join `delivery`.`tipo_ajuste_financiero` `T` on((`A`.`IdTipoAjusteFinanciero` = `T`.`IdTipoAjusteFinanciero`))) join `delivery`.`estado_ajuste_financiero` `E` on((`A`.`IdEstado` = `E`.`IdEstado`))) join `delivery`.`cuenta_financiera` `C` on((`C`.`IdCuentaFinanciera` = `A`.`IdCuentaFinanciera`))) where ((`T`.`IdTipoAjusteFinanciero` = 2) and (`E`.`IdEstado` in (1,2)) and (`C`.`SKU` <> 'CSUC09')) group by `T`.`IdTipoAjusteFinanciero`,`T`.`Nombre`,`A`.`IdSucursal`,`A`.`PeriodoDesde`,`A`.`PeriodoHasta`) `CAR` on(((`X`.`PeriodoFacturacionInicioComercio` = `CAR`.`PeriodoInicio`) and (`X`.`PeriodoFacturacionFinComercio` = `CAR`.`PeriodoFin`) and (`X`.`IdSucursal` = `CAR`.`IdSucursal`)))) where ((`X`.`CodigoTipoPedido` in ('PEDNORMAL','PEDESPECIAL','PEDAGILFAVOR')) and ((`X`.`CodigoTipoPedido` = 'PEDAGILFAVOR') or (`X`.`EsPedidoHijo` = 'SI') or ((`X`.`EsPedidoHijo` = 'NO') and (`X`.`EstadoPago` in ('Activo','Reembolsado'))))) group by `X`.`IdComercio`,`X`.`Comercio`,`X`.`IdSucursal`,`X`.`Sucursal`,`X`.`DiaDepositoComercio`,`X`.`PeriodoFacturacionInicioComercio`,`X`.`PeriodoFacturacionFinComercio`,`DEV`.`Cantidad`,`DEV`.`MontoBruto`,`CAR`.`Cantidad`,`CAR`.`MontoBruto`) `X` where (`X`.`PeriodoFacturacionInicioComercio` is not null) group by `X`.`DiaDepositoComercio` order by `X`.`DiaDepositoComercio` desc