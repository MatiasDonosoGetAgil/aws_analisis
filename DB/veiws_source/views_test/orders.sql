select `p`.`IdPedido` AS `IdPedido`,`p`.`Codigo` AS `Codigo`,`p`.`Corelativo` AS `Corelativo`,`p`.`IdComercio` AS `IdComercio`,`p`.`IdSucursal` AS `IdSucursal`,`s`.`Titulo` AS `Sucursal`,`s`.`Telefono` AS `TelefonoSucursal`,`p`.`IdCliente` AS `IdCliente`,`p`.`IdClienteDireccion` AS `IdClienteDireccion`,`p`.`TipoEntrega` AS `TipoEntrega`,`p`.`TotalPago` AS `TotalPago`,`p`.`GastosEnvio` AS `GastosEnvio`,`p`.`Comentario` AS `Comentario`,`p`.`Calificacion` AS `Calificacion`,`p`.`Propina` AS `Propina`,`p`.`Tiempo` AS `Tiempo`,`p`.`FechaCreacion` AS `FechaCreacion`,`p`.`IdEstado` AS `IdEstado`,`com`.`RazonSocial` AS `Comercio`,((`p`.`TotalPago` + `p`.`Propina`) + `p`.`GastosEnvio`) AS `TotalFinal`,(select count(`pd`.`Id`) from `pedido_detalle` `pd` where ((`pd`.`IdPedido` = `p`.`IdPedido`) and (`pd`.`IdEstado` <> 2))) AS `Items`,concat(`u`.`Nombre`,' ',`u`.`Apellido`) AS `Cliente`,concat(`u`.`Email`,' | ',`u`.`Telefono`) AS `Contacto`,`u`.`Email` AS `Email`,`u`.`Telefono` AS `Telefono`,`u`.`Imagen` AS `ClientePic`,`pe`.`Fecha` AS `Fecha`,`pp`.`IdTipoPago` AS `IdTipoPago`,`tp`.`tipo_pago` AS `MetodoPago`,`pp`.`IdMedioPago` AS `IdMedioPago`,coalesce(`pp`.`IdEstado`,0) AS `IdEstadoPago`,`estp`.`Descripcion` AS `EstadoPago`,`mp`.`medio_pago` AS `MedioPago`,(case when (`pe`.`TipoEntrega` = 1) then 'Delivery' else 'Retiro en Tienda' end) AS `Tipo_Entrega`,(case when (`pe`.`TipoDelivery` = 1) then 'Encontrarse en la puerta' when (`pe`.`TipoDelivery` = 2) then 'Encontrarse afuera' when (`pe`.`TipoDelivery` = 3) then 'Dejar el paquete en conserjería o en la puerta si es una caja' else '' end) AS `TipoDelivery`,(case when (`pe`.`TipoFechaEntrega` = 1) then 'Delivery Express' when (`pe`.`TipoFechaEntrega` = 2) then 'Mañana' when (`pe`.`TipoFechaEntrega` = 3) then 'Fecha Programada' else '' end) AS `TipoFechaEntrega`,`pe`.`TipoFechaEntrega` AS `IdTipoFechaEntrega`,`pe`.`FechaEstimadaEntrega` AS `FechaEstimadaEntrega`,`pe`.`FechaEstimadaEntregaMax` AS `FechaEstimadaEntregaMax`,(case when (`pe`.`TipoEntrega` = 1) then concat(`ud`.`Direccion`,' ',`ud`.`Nro`,' ',coalesce(`cu`.`Comuna`,'')) else concat('Tienda: ',`s`.`Titulo`) end) AS `LugarEntrega`,concat(`ud`.`Direccion`,' ',`ud`.`Nro`,' ',coalesce(`cu`.`Comuna`,'')) AS `UserDireccion`,`ud`.`Direccion` AS `ClienteDireccion`,`ud`.`Nro` AS `RefDireccion`,`cs`.`Comuna` AS `ComunaSucursal`,concat(`s`.`Direccion`,' ',`cs`.`Comuna`) AS `SucursalDireccion`,(case when (`p`.`IdEstado` = 1) then 'Pendiente' when (`p`.`IdEstado` = 2) then 'Fallido' else `est`.`Descripcion` end) AS `Estado`,`pe`.`IdRider` AS `IdRider`,concat(`rider`.`Nombre`,' ',`rider`.`Apellido`) AS `Rider`,`rider`.`Mail` AS `RiderEmail`,`rdp`.`Num_Telefono` AS `RiderTlf`,`rider`.`Avatar_Img` AS `RiderPic`,`pe`.`IdMovil` AS `IdMovil`,`riderm`.`Patente` AS `Patente`,`pe`.`LLAVE` AS `LLAVE`,`pp`.`Tarjeta` AS `Tarjeta`,`pp`.`resultado` AS `ResultadoPago`,`prepa_coci`.`FechaEntrada` AS `FechaUTCEntradaCocina`,`prepa_coci`.`FechaEntregaMinima` AS `FechaUTCEntregaMinCocina`,`prepa_coci`.`FechaEntregaMaxima` AS `FechaUTCEntregaMaxCocina` from ((((((((((((((((`pedidos` `p` left join `pedido_entrega` `pe` on(((`pe`.`IdPedido` = `p`.`IdPedido`) and (`pe`.`IdEstado` = 1)))) left join `pedido_pago` `pp` on(((`pp`.`IdPedido` = `p`.`IdPedido`) and (`pp`.`IdEstado` <> 2)))) left join `usuario_direcciones` `ud` on((`ud`.`Id` = `p`.`IdClienteDireccion`))) left join `comuna` `cu` on((`cu`.`IdComuna` = `ud`.`IdComuna`))) left join `sucursal` `s` on((`s`.`IdSucursal` = `p`.`IdSucursal`))) left join `comuna` `cs` on((`cs`.`IdComuna` = `s`.`IdComuna`))) left join `usuario` `u` on((`u`.`IdUsuario` = `p`.`IdCliente`))) left join `estado` `est` on((`est`.`Id` = `p`.`IdEstado`))) left join `comercio` `com` on((`com`.`IdComercio` = `p`.`IdComercio`))) left join `rider` on((`rider`.`Id_Rider` = `pe`.`IdRider`))) left join `rider_vehiculo` `riderm` on((`riderm`.`Id_Vehiculo` = `pe`.`IdMovil`))) left join `medio_pago` `mp` on((`mp`.`id` = `pp`.`IdMedioPago`))) left join `tipo_pago` `tp` on((`tp`.`id_tipo_pago` = `pp`.`IdTipoPago`))) left join `estado` `estp` on((`estp`.`Id` = `pp`.`IdEstado`))) left join `rider_dispositivo` `rdp` on((`rdp`.`Id_Rider` = `rider`.`Id_Rider`))) left join `pedido_preparacion_cocina` `prepa_coci` on((`p`.`IdPedido` = `prepa_coci`.`IdPedido`)))