select `A`.`Comercio` AS `Comercio`,(case when ((ifnull(`B`.`Codigo`,0) = 0) and (ifnull(`C`.`Codigo`,0) = 0)) then 'SIN VENTAS' when (ifnull(`B`.`Codigo`,0) > ifnull(`C`.`Codigo`,0)) then 'ALZA' when (ifnull(`B`.`Codigo`,0) < ifnull(`C`.`Codigo`,0)) then 'BAJA' when (ifnull(`B`.`Codigo`,0) = ifnull(`C`.`Codigo`,0)) then 'MANTIENE' end) AS `EstadoPedidos`,(case when (((ifnull(`B`.`Codigo`,0) = 0) and (ifnull(`C`.`Codigo`,0) = 0)) or (ifnull(`B`.`Codigo`,0) = ifnull(`C`.`Codigo`,0))) then 0 when (((ifnull(`B`.`Codigo`,0) = 0) and (ifnull(`C`.`Codigo`,0) > 0)) or ((ifnull(`B`.`Codigo`,0) > 0) and (ifnull(`C`.`Codigo`,0) = 0))) then 100 when (ifnull(`B`.`Codigo`,0) > ifnull(`C`.`Codigo`,0)) then round((((ifnull(`B`.`Codigo`,0) * 100) / ifnull(`C`.`Codigo`,0)) - 100),0) when (ifnull(`B`.`Codigo`,0) < ifnull(`C`.`Codigo`,0)) then round((100 - ((ifnull(`B`.`Codigo`,0) * 100) / ifnull(`C`.`Codigo`,0))),0) end) AS `VariacionPedidos`,(case when ((ifnull(`D`.`Codigo`,0) = 0) and (ifnull(`B`.`Codigo`,0) = 0)) then 'SIN VENTAS' when (ifnull(`D`.`Codigo`,0) > ifnull(`B`.`Codigo`,0)) then 'ALZA' when (ifnull(`D`.`Codigo`,0) < ifnull(`B`.`Codigo`,0)) then 'BAJA' when (ifnull(`D`.`Codigo`,0) = ifnull(`B`.`Codigo`,0)) then 'MANTIENE' end) AS `EstadoPedidosPredictivo`,(case when (((ifnull(`D`.`Codigo`,0) = 0) and (ifnull(`B`.`Codigo`,0) = 0)) or (ifnull(`D`.`Codigo`,0) = ifnull(`B`.`Codigo`,0))) then 0 when (((ifnull(`D`.`Codigo`,0) = 0) and (ifnull(`B`.`Codigo`,0) > 0)) or ((ifnull(`D`.`Codigo`,0) > 0) and (ifnull(`B`.`Codigo`,0) = 0))) then 100 when (ifnull(`D`.`Codigo`,0) > ifnull(`B`.`Codigo`,0)) then round((((ifnull(`D`.`Codigo`,0) * 100) / ifnull(`B`.`Codigo`,0)) - 100),0) when (ifnull(`D`.`Codigo`,0) < ifnull(`B`.`Codigo`,0)) then round((100 - ((ifnull(`D`.`Codigo`,0) * 100) / ifnull(`B`.`Codigo`,0))),0) end) AS `VariacionPedidosPredictivo`,round(ifnull(`B`.`Codigo`,0),0) AS `PedidosUltimoMes`,round(ifnull(`C`.`Codigo`,0),0) AS `PedidosDosMeses`,round(ifnull(`D`.`Codigo`,0),0) AS `PedidosMesActual`,round(ifnull(`E`.`Codigo`,0),0) AS `PedidosMesActualHastaHoy`,(case when ((ifnull(`B`.`Subtotal`,0) = 0) and (ifnull(`C`.`Subtotal`,0) = 0)) then 'SIN VENTAS' when (ifnull(`B`.`Subtotal`,0) > ifnull(`C`.`Subtotal`,0)) then 'ALZA' when (ifnull(`B`.`Subtotal`,0) < ifnull(`C`.`Subtotal`,0)) then 'BAJA' when (ifnull(`B`.`Subtotal`,0) = ifnull(`C`.`Subtotal`,0)) then 'MANTIENE' end) AS `EstadoSubtotal`,(case when (((ifnull(`B`.`Subtotal`,0) = 0) and (ifnull(`C`.`Subtotal`,0) = 0)) or (ifnull(`B`.`Subtotal`,0) = ifnull(`C`.`Subtotal`,0))) then 0 when (((ifnull(`B`.`Subtotal`,0) = 0) and (ifnull(`C`.`Subtotal`,0) > 0)) or ((ifnull(`B`.`Subtotal`,0) > 0) and (ifnull(`C`.`Subtotal`,0) = 0))) then 100 when (ifnull(`B`.`Subtotal`,0) > ifnull(`C`.`Subtotal`,0)) then round((((ifnull(`B`.`Subtotal`,0) * 100) / ifnull(`C`.`Subtotal`,0)) - 100),0) when (ifnull(`B`.`Subtotal`,0) < ifnull(`C`.`Subtotal`,0)) then round((100 - ((ifnull(`B`.`Subtotal`,0) * 100) / ifnull(`C`.`Subtotal`,0))),0) end) AS `VariacionSubtotal`,(case when ((ifnull(`D`.`Subtotal`,0) = 0) and (ifnull(`B`.`Subtotal`,0) = 0)) then 'SIN VENTAS' when (ifnull(`D`.`Subtotal`,0) > ifnull(`B`.`Subtotal`,0)) then 'ALZA' when (ifnull(`D`.`Subtotal`,0) < ifnull(`B`.`Subtotal`,0)) then 'BAJA' when (ifnull(`D`.`Subtotal`,0) = ifnull(`B`.`Subtotal`,0)) then 'MANTIENE' end) AS `EstadoSubtotalPredictivo`,(case when (((ifnull(`D`.`Subtotal`,0) = 0) and (ifnull(`B`.`Subtotal`,0) = 0)) or (ifnull(`D`.`Subtotal`,0) = ifnull(`B`.`Subtotal`,0))) then 0 when (((ifnull(`D`.`Subtotal`,0) = 0) and (ifnull(`B`.`Subtotal`,0) > 0)) or ((ifnull(`D`.`Subtotal`,0) > 0) and (ifnull(`B`.`Subtotal`,0) = 0))) then 100 when (ifnull(`D`.`Subtotal`,0) > ifnull(`B`.`Subtotal`,0)) then round((((ifnull(`D`.`Subtotal`,0) * 100) / ifnull(`B`.`Subtotal`,0)) - 100),0) when (ifnull(`D`.`Subtotal`,0) < ifnull(`B`.`Subtotal`,0)) then round((100 - ((ifnull(`D`.`Subtotal`,0) * 100) / ifnull(`B`.`Subtotal`,0))),0) end) AS `VariacionSubtotalPredictivo`,round(ifnull(`B`.`Subtotal`,0),0) AS `SubtotalUltimoMes`,round(ifnull(`C`.`Subtotal`,0),0) AS `SubtotalDosMeses`,round(ifnull(`D`.`Subtotal`,0),0) AS `SubtotalMesActual`,round(ifnull(`E`.`Subtotal`,0),0) AS `SubtotalMesActualHastaHoy`,(case when ((ifnull(`B`.`NetoAgil`,0) = 0) and (ifnull(`C`.`NetoAgil`,0) = 0)) then 'SIN VENTAS' when (ifnull(`B`.`NetoAgil`,0) > ifnull(`C`.`NetoAgil`,0)) then 'ALZA' when (ifnull(`B`.`NetoAgil`,0) < ifnull(`C`.`NetoAgil`,0)) then 'BAJA' when (ifnull(`B`.`NetoAgil`,0) = ifnull(`C`.`NetoAgil`,0)) then 'MANTIENE' end) AS `EstadoNetoAgil`,(case when (((ifnull(`B`.`NetoAgil`,0) = 0) and (ifnull(`C`.`NetoAgil`,0) = 0)) or (ifnull(`B`.`NetoAgil`,0) = ifnull(`C`.`NetoAgil`,0))) then 0 when (((ifnull(`B`.`NetoAgil`,0) = 0) and (ifnull(`C`.`NetoAgil`,0) > 0)) or ((ifnull(`B`.`NetoAgil`,0) > 0) and (ifnull(`C`.`NetoAgil`,0) = 0))) then 100 when (ifnull(`B`.`NetoAgil`,0) > ifnull(`C`.`NetoAgil`,0)) then round((((ifnull(`B`.`NetoAgil`,0) * 100) / ifnull(`C`.`NetoAgil`,0)) - 100),0) when (ifnull(`B`.`NetoAgil`,0) < ifnull(`C`.`NetoAgil`,0)) then round((100 - ((ifnull(`B`.`NetoAgil`,0) * 100) / ifnull(`C`.`NetoAgil`,0))),0) end) AS `VariacionNetoAgil`,(case when ((ifnull(`D`.`NetoAgil`,0) = 0) and (ifnull(`C`.`NetoAgil`,0) = 0)) then 'SIN VENTAS' when (ifnull(`D`.`NetoAgil`,0) > ifnull(`C`.`NetoAgil`,0)) then 'ALZA' when (ifnull(`D`.`NetoAgil`,0) < ifnull(`C`.`NetoAgil`,0)) then 'BAJA' when (ifnull(`D`.`NetoAgil`,0) = ifnull(`C`.`NetoAgil`,0)) then 'MANTIENE' end) AS `EstadoNetoAgilPredictivo`,(case when (((ifnull(`D`.`NetoAgil`,0) = 0) and (ifnull(`B`.`NetoAgil`,0) = 0)) or (ifnull(`D`.`NetoAgil`,0) = ifnull(`B`.`NetoAgil`,0))) then 0 when (((ifnull(`D`.`NetoAgil`,0) = 0) and (ifnull(`B`.`NetoAgil`,0) > 0)) or ((ifnull(`D`.`NetoAgil`,0) > 0) and (ifnull(`B`.`NetoAgil`,0) = 0))) then 100 when (ifnull(`D`.`NetoAgil`,0) > ifnull(`B`.`NetoAgil`,0)) then round((((ifnull(`D`.`NetoAgil`,0) * 100) / ifnull(`B`.`NetoAgil`,0)) - 100),0) when (ifnull(`D`.`NetoAgil`,0) < ifnull(`B`.`NetoAgil`,0)) then round((100 - ((ifnull(`D`.`NetoAgil`,0) * 100) / ifnull(`B`.`NetoAgil`,0))),0) end) AS `VariacionNetoAgilPredictivo`,round(ifnull(`B`.`NetoAgil`,0),0) AS `NetoAgilUltimoMes`,round(ifnull(`C`.`NetoAgil`,0),0) AS `NetoAgilDosMeses`,round(ifnull(`D`.`NetoAgil`,0),0) AS `NetoAgilMesActual`,round(ifnull(`E`.`NetoAgil`,0),0) AS `NetoAgilMesActualHastaHoy` from ((((((select distinct `delivery`.`kpi_predictivo_ventas_detalle`.`Comercio` AS `Comercio` from `delivery`.`kpi_predictivo_ventas_detalle`)) `A` left join (select `delivery`.`kpi_predictivo_ventas_detalle`.`Comercio` AS `Comercio`,`delivery`.`kpi_predictivo_ventas_detalle`.`Mes` AS `Mes`,round(count(`delivery`.`kpi_predictivo_ventas_detalle`.`Codigo`),0) AS `Codigo`,round(sum(`delivery`.`kpi_predictivo_ventas_detalle`.`Subtotal`),0) AS `Subtotal`,round(sum(`delivery`.`kpi_predictivo_ventas_detalle`.`NetoAgil`),0) AS `NetoAgil` from `delivery`.`kpi_predictivo_ventas_detalle` where (`delivery`.`kpi_predictivo_ventas_detalle`.`Orden` = 1) group by `delivery`.`kpi_predictivo_ventas_detalle`.`Comercio`,`delivery`.`kpi_predictivo_ventas_detalle`.`Mes`) `B` on((`A`.`Comercio` = `B`.`Comercio`))) left join (select `delivery`.`kpi_predictivo_ventas_detalle`.`Comercio` AS `Comercio`,`delivery`.`kpi_predictivo_ventas_detalle`.`Mes` AS `Mes`,round(count(`delivery`.`kpi_predictivo_ventas_detalle`.`Codigo`),0) AS `Codigo`,round(sum(`delivery`.`kpi_predictivo_ventas_detalle`.`Subtotal`),0) AS `Subtotal`,round(sum(`delivery`.`kpi_predictivo_ventas_detalle`.`NetoAgil`),0) AS `NetoAgil` from `delivery`.`kpi_predictivo_ventas_detalle` where (`delivery`.`kpi_predictivo_ventas_detalle`.`Orden` = 2) group by `delivery`.`kpi_predictivo_ventas_detalle`.`Comercio`,`delivery`.`kpi_predictivo_ventas_detalle`.`Mes`) `C` on((`A`.`Comercio` = `C`.`Comercio`))) left join (select `X`.`Comercio` AS `Comercio`,(select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` where (`X`.`Fecha` = curdate()) limit 1) AS `Mes`,round(avg(`X`.`Codigo`),0) AS `Codigo`,round(avg(`X`.`Subtotal`),0) AS `Subtotal`,round(avg(`X`.`NetoAgil`),0) AS `NetoAgil` from (select `X`.`Comercio` AS `Comercio`,`X`.`Mes` AS `Mes`,count(`X`.`Codigo`) AS `Codigo`,sum(`X`.`Subtotal`) AS `Subtotal`,sum(`X`.`NetoAgil`) AS `NetoAgil` from (select distinct `A`.`Id` AS `Id`,`A`.`Comercio` AS `Comercio`,`A`.`Mes` AS `Mes`,`A`.`MesNumero` AS `MesNumero`,`A`.`DiaNombre` AS `DiaNombre`,`A`.`DiaNumero` AS `DiaNumero`,`A`.`Fecha` AS `Fecha`,`A`.`Codigo` AS `Codigo`,`A`.`Subtotal` AS `Subtotal`,`A`.`NetoAgil` AS `NetoAgil`,`A`.`PrimerLunes` AS `PrimerLunes`,`A`.`Semana` AS `Semana`,`A`.`Orden` AS `Orden` from (`delivery`.`kpi_predictivo_ventas_detalle` `A` join (select `A`.`Id` AS `Id`,`A`.`Comercio` AS `Comercio`,`A`.`Mes` AS `Mes`,`A`.`MesNumero` AS `MesNumero`,`A`.`DiaNombre` AS `DiaNombre`,`A`.`DiaNumero` AS `DiaNumero`,`A`.`Fecha` AS `Fecha`,`A`.`Codigo` AS `Codigo`,`A`.`Subtotal` AS `Subtotal`,`A`.`NetoAgil` AS `NetoAgil`,`A`.`PrimerLunes` AS `PrimerLunes`,`A`.`Semana` AS `Semana`,`A`.`Orden` AS `Orden` from `delivery`.`kpi_predictivo_ventas_detalle` `A` where (`A`.`Mes` = (select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` where (`X`.`Fecha` = curdate()) limit 1)) union all select `B`.`Id` AS `Id`,`B`.`Comercio` AS `Comercio`,`B`.`Mes` AS `Mes`,`B`.`MesNumero` AS `MesNumero`,`B`.`DiaNombre` AS `DiaNombre`,`B`.`DiaNumero` AS `DiaNumero`,`B`.`Fecha` AS `Fecha`,`B`.`Codigo` AS `Codigo`,`B`.`Subtotal` AS `Subtotal`,`B`.`NetoAgil` AS `NetoAgil`,`B`.`PrimerLunes` AS `PrimerLunes`,`B`.`Semana` AS `Semana`,`B`.`Orden` AS `Orden` from `delivery`.`kpi_predictivo_ventas_prediccion` `B` where (`B`.`Mes` = (select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` where (`X`.`Fecha` = curdate()) limit 1))) `B` on(((`A`.`DiaNombre` = `B`.`DiaNombre`) and (`A`.`Semana` = `B`.`Semana`)))) where (`A`.`Orden` in (1,2,3))) `X` group by `X`.`Comercio`,`X`.`Mes`) `X` group by `X`.`Comercio`) `D` on((`A`.`Comercio` = `D`.`Comercio`))) left join (select `delivery`.`kpi_predictivo_ventas_detalle`.`Comercio` AS `Comercio`,`delivery`.`kpi_predictivo_ventas_detalle`.`Mes` AS `Mes`,round(count(`delivery`.`kpi_predictivo_ventas_detalle`.`Codigo`),0) AS `Codigo`,round(sum(`delivery`.`kpi_predictivo_ventas_detalle`.`Subtotal`),0) AS `Subtotal`,round(sum(`delivery`.`kpi_predictivo_ventas_detalle`.`NetoAgil`),0) AS `NetoAgil` from `delivery`.`kpi_predictivo_ventas_detalle` where (`delivery`.`kpi_predictivo_ventas_detalle`.`Mes` = (select `X`.`Mes` from `delivery`.`kpi_predictivo_ventas_prediccion` `X` where (`X`.`Fecha` = curdate()) limit 1)) group by `delivery`.`kpi_predictivo_ventas_detalle`.`Comercio`,`delivery`.`kpi_predictivo_ventas_detalle`.`Mes`) `E` on((`A`.`Comercio` = `E`.`Comercio`))) order by `A`.`Comercio`