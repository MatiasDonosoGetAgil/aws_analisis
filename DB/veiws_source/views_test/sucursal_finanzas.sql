select `p`.`IdSucursal` AS `IdSucursal`,`p`.`IdEstado` AS `IdEstadoPedido`,`pp`.`IdEstado` AS `IdEstadoPago`,`pe`.`FechaEstimadaEntrega` AS `FechaPago`,`p`.`IdPedido` AS `IdPedido`,`p`.`Codigo` AS `Codigo`,`p`.`Corelativo` AS `Corelativo`,ifnull(`p`.`TotalPago`,0) AS `SubTotal`,ifnull(`p`.`GastosEnvio`,0) AS `Delivery`,ifnull(`p`.`Propina`,0) AS `Propina`,if(isnull(`p`.`IdPedidoBase`),`p`.`Total_OC`,0) AS `TOTAL`,(`n`.`IVA` / 100) AS `IVA_PORC`,`mp`.`medio_pago` AS `MedioPago`,`tp`.`tipo_pago` AS `TipoPago`,ifnull((`ppr`.`comision` / `ppr`.`monto`),0) AS `MedioPagoImpuesto`,round((select ifnull(`ppr`.`comision`,0)),3) AS `MedioPagoMonto`,round((select ifnull(`ppr`.`impuestos`,0)),3) AS `MedioPagoIVA`,round((select (`MedioPagoMonto` + `pp`.`MedioPagoIVA`)),3) AS `MedioPagoTotal`,(`p`.`GastosEnvio` / (select (1 + `IVA_PORC`))) AS `DeliveryMonto`,round((select (`DeliveryMonto` * `IVA_PORC`)),3) AS `DeliveryIva`,round(`p`.`GastosEnvio`,3) AS `DeliveryTotal`,`p`.`GastosEnvio` AS `DeliveryMontoOriginal`,round((select (`DeliveryMonto` * `IVA_PORC`)),3) AS `DeliveryIvaOriginal`,round((select (`DeliveryMonto` + `DeliveryIva`)),3) AS `DeliveryTotalOriginal`,`p`.`Propina` AS `PropinaMonto`,round(0,3) AS `PropinaIva`,round((select (`PropinaMonto` + `PropinaIva`)),3) AS `PropinaTotal`,if(isnull(`p`.`IdPedidoBase`),(`cs1`.`Valor` / 100),0) AS `TarifaVenta`,round((select (`p`.`SubTotal` * `TarifaVenta`)),3) AS `TarifaVentaMonto`,round((select (`TarifaVentaMonto` * `IVA_PORC`)),3) AS `TarifaVentaIVA`,round((select (`TarifaVentaMonto` + `TarifaVentaIVA`)),3) AS `TarifaVentaTotal`,`pe`.`TipoEntrega` AS `IdTipoEntrega`,if((`pe`.`TipoEntrega` = 1),(ifnull(`cs2`.`Valor`,0) / 100),0) AS `TarifaDelivery`,round((select (`p`.`SubTotal` * `TarifaDelivery`)),3) AS `TarifaDeliveryMonto`,round((select (`TarifaDeliveryMonto` * `IVA_PORC`)),3) AS `TarifaDeliveryIVA`,round((select (`TarifaDeliveryMonto` + `TarifaDeliveryIVA`)),3) AS `TarifaDeliveryTotal`,round((select ((((`MedioPagoTotal` + `DeliveryTotal`) + `PropinaTotal`) + `TarifaVentaTotal`) + `TarifaDeliveryTotal`)),3) AS `Retencion`,round((select (`TOTAL` - `Retencion`)),3) AS `Neto` from ((((((((((`pedidos` `p` left join `pedido_pago` `pp` on((`p`.`IdPedido` = `pp`.`IdPedido`))) left join `pedido_entrega` `pe` on((`p`.`IdPedido` = `pe`.`IdPedido`))) left join `comercio` `c` on((`p`.`IdComercio` = `c`.`IdComercio`))) left join `nacionalidad` `n` on((`c`.`IdNacionalidad` = `n`.`Id`))) left join `medio_pago` `mp` on((`pp`.`IdMedioPago` = `mp`.`id`))) left join `tipo_pago` `tp` on((`pp`.`IdTipoPago` = `tp`.`id_tipo_pago`))) left join `pedido_pago_respuesta` `ppr` on((`pp`.`IdPago` = `ppr`.`idPago`))) left join `sucursal` `s` on((`p`.`IdSucursal` = `s`.`IdSucursal`))) left join `comision_sucursal` `cs1` on(((`cs1`.`IdSucursal` = `s`.`IdSucursal`) and (`cs1`.`IdTipoComision` = 1)))) left join `comision_sucursal` `cs2` on(((`cs2`.`IdSucursal` = `s`.`IdSucursal`) and (`cs2`.`IdTipoComision` = 2))))