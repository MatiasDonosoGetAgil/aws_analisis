select (1 + (select count(0) from `pedidos` where (`pedidos`.`IdPedido` < `p`.`IdPedido`))) AS `IdOrdenCompra`,`p`.`IdPedido` AS `IdPedido`,`p`.`IdComercio` AS `IdComercio`,`p`.`IdSucursal` AS `IdSucursal`,`p`.`FechaCreacion` AS `Fecha`,`pp`.`IdPago` AS `IdPago`,`pe`.`IdEntrega` AS `IdViaje`,`p`.`IdEstado` AS `IdEstadoPedido`,`pp`.`IdEstado` AS `IdEstadoPago`,`p`.`TotalPago` AS `ValorPedido`,`p`.`Propina` AS `Propina`,(case when (`pe`.`TipoEntrega` = 1) then ((1800 * 0.19) + 1800) else 0 end) AS `TotalViaje`,sum(((`p`.`TotalPago` + `p`.`Propina`) + (case when (`pe`.`TipoEntrega` = 1) then ((1800 * 0.19) + 1800) else 0 end))) AS `ValorOrdenCompra` from ((`pedidos` `p` left join `pedido_entrega` `pe` on(((`pe`.`IdPedido` = `p`.`IdPedido`) and (`pe`.`IdEstado` = 1)))) left join `pedido_pago` `pp` on(((`pp`.`IdPedido` = `p`.`IdPedido`) and (`pp`.`IdEstado` <> 2)))) where (`p`.`IdEstado` <> 2) group by `p`.`IdPedido`,`pe`.`IdEntrega`,`pp`.`IdPago`